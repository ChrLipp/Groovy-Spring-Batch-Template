apply plugin: 'eclipse'
apply plugin: 'groovy'
// currently breaks the Cloudbees build due to obsolete gradle version
//apply plugin: 'codenarc'

repositories {
	mavenCentral()
	maven { url "http://maven.springframework.org/release" }
}

dependencies {

	final SPRING_VERSION = '3.1.1.RELEASE'
	final BATCH_VERSION = '2.1.8.RELEASE'

	groovy group: 'org.codehaus.groovy', name: 'groovy-all', version: '1.8.6'

	compile group: 'org.springframework.batch', name: 'spring-batch-core', version: BATCH_VERSION

	// Spring Batch on top of Spring 3.1 (primarily to avoid xml configuration)
	// (latest version wins in conflict resolution)
	compile group: 'org.springframework', name: 'spring-tx', version: SPRING_VERSION
	compile group: 'org.springframework', name: 'spring-jdbc', version: SPRING_VERSION
//	compile group: 'org.springframework', name: 'spring-orm', version: SPRING_VERSION
//	compile group: 'org.springframework', name: 'spring-oxm', version: SPRING_VERSION
	compile group: 'cglib', name: 'cglib-nodep', version: '2.2.2'
	compile group: 'commons-dbcp', name: 'commons-dbcp', version: '1.4'
	
	// beanbuilder dsl would be a nice addition, but it's dependency graph is awful
	//compile group: 'org.grails', name: 'grails-spring', version: '2.0.2'
	
	testCompile group: 'org.spockframework', name: 'spock-core', version: '0.6-groovy-1.8'
	testCompile group: 'org.spockframework', name: 'spock-spring', version: '0.6-groovy-1.8'
	testCompile group: 'org.springframework.batch', name: 'spring-batch-test', version: BATCH_VERSION
	testCompile group: 'org.springframework', name: 'spring-test', version: SPRING_VERSION
	testCompile group: 'hsqldb', name: 'hsqldb', version: '1.8.0.10'
}

jar {
//	bundle all dependencies to produce a fat standalone jar -> META-INF/spring.handlers need to be merged properly
//	from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
	
	manifest {
		attributes 'Main-Class': 'org.springframework.batch.core.launch.support.CommandLineJobRunner'
	}
}

//codenarc {
//	toolVersion = '0.17'
//	configFile = new File("${project.projectDir.absolutePath}/config/codenarc/ruleset.groovy")
//	
//	// consumed by Jenkins Violations plugin
//	reportFormat = 'xml'
//	
//	// don't let codenarc violations fail the build
//	tasks.withType(CodeNarc).all { codeNarcTask ->
//		codeNarcTask.ignoreFailures = true
//	}
//}
